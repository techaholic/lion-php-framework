WindowStore={doSetCookie:false,cookieName:"__window_store__",expired:null,init:function(d,b){WindowStore.cookieName=d||WindowStore.cookieName;if(!b){var a=new Date();a.setYear(a.getYear()+1903);WindowStore.expired=a}else{WindowStore.expired=b}Windows.windows.each(function(e){e.setCookie(e.getId(),WindowStore.expired)});var c={onShow:function(e,f){WindowStore._saveCookie()},onClose:function(e,f){WindowStore._saveCookie()},onHide:function(e,f){WindowStore._saveCookie()}};Windows.addObserver(c);WindowStore._restoreWindows();WindowStore._saveCookie()},show:function(win){eval("var cookie = "+WindowUtilities.getCookie(WindowStore.cookieName));if(cookie!=null){if(cookie[win.getId()]){win.show()}}else{win.show()}},_saveCookie:function(){if(!doSetCookie){return}var a="{";Windows.windows.each(function(b){if(a!="{"){a+=","}a+=b.getId()+": "+b.isVisible()});a+="}";WindowUtilities.setCookie(a,[WindowStore.cookieName,WindowStore.expired])},_restoreWindows:function(){eval("var cookie = "+WindowUtilities.getCookie(WindowStore.cookieName));if(cookie!=null){doSetCookie=false;Windows.windows.each(function(win){if(cookie[win.getId()]){win.show()}})}doSetCookie=true}};WindowCloseKey={keyCode:Event.KEY_ESC,init:function(a){if(a){WindowCloseKey.keyCode=a}Event.observe(document,"keydown",this._closeCurrentWindow.bindAsEventListener(this))},_closeCurrentWindow:function(b){var d=b||window.event;var a=d.which||d.keyCode;var c=top.Windows.focusedWindow;if(a==WindowCloseKey.keyCode&&c){if(c.cancelCallback){top.Dialog.cancelCallback()}else{if(c.okCallback){top.Dialog.okCallback()}else{top.Windows.close(top.Windows.focusedWindow.getId())}}}}};
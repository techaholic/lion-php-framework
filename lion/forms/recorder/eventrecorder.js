Object.extend(Event,{wheel:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera){b=-b}}else{if(a.detail){b=-a.detail/3}}return Math.round(b)}});__MouseEventFrame=Class.create({initialize:function(c,b,d){this.mouseX=c;this.mouseY=b;this.time=d;var a=document.viewport.getScrollOffsets();this.scrollX=a.left;this.scrollY=a.top},updateScroll:function(){var a=document.viewport.getScrollOffsets();if(this.scrollX!=a.left||this.scrollY!=a.top){window.scrollBy(this.scrollX,this.scrollY)}}});__MouseMoveEventFrame=Class.create(__MouseEventFrame,{play:function(){this.updateScroll();new Effect.Move($("mousepointer"),{duration:0.3,x:this.mouseX,y:this.mouseY,mode:"absolute"})}});__MouseWheelEventFrame=Class.create(__MouseEventFrame,{play:function(){this.updateScroll();new Effect.Move($("mousepointer"),{duration:0.3,x:this.mouseX,y:this.mouseY,mode:"absolute"})}});__MouseClickEventFrame=Class.create(__MouseEventFrame,{play:function(){this.updateScroll();new Effect.Move($("mousepointer"),{duration:0.3,x:this.mouseX,y:this.mouseY,mode:"absolute"});setTimeout(this.showClick.bind(this),300)},showClick:function(){var a=new Element("img",{src:"/forms/recorder/click_spot.png",style:"width: 9px; height: 9px; position: absolute; left: "+(this.mouseX-4)+"px; top: "+(this.mouseY-3)+"px; z-index: 99999;"});document.getElementsByTagName("body")[0].appendChild(a);a.style.display="";setTimeout(this.hiddenClick.bind(this,a),1000)},hiddenClick:function(a){a.style.display="none";a.remove()}});__KeypressEventFrame=Class.create({initialize:function(a,b,c,d){this.keycode=a;this.element=b;this.value=c;this.time=d},play:function(){if(document.createEventObject){var a=document.createEventObject();a.keycode=this.keycode;this.element.fireEvent("onkeypress",a)}else{var a=document.createEvent("HTMLEvents");a.initEvent("keypress",true,true);a.keycode=this.keycode;this.element.dispatchEvent(a)}this.element.value=this.value}});__EventObserver=Class.create({startObserving:function(){document.observe(this.eventType,this.saveFrame.bind(this))},stopObserving:function(){document.stopObserving(this.eventType)},saveFrame:function(c){var b=__RecordingSession.getInstance();if(b.lockRecord){clearTimeout(b.lockRecord)}var a=this.getEventFrame(c);b.lockRecord=setTimeout(b.saveFrame.bind(b,a),20)}});__MouseMoveObserver=Class.create(__EventObserver,{initialize:function(){this.eventType="mousemove"},getEventFrame:function(d){var b=Event.pointerX(d);var a=Event.pointerY(d);var c=new __MouseMoveEventFrame(b,a,new Date().getTime());return c}});__MouseClickObserver=Class.create(__EventObserver,{initialize:function(){this.eventType="click"},getEventFrame:function(d){var b=Event.pointerX(d);var a=Event.pointerY(d);var c=new __MouseClickEventFrame(b,a,new Date().getTime());return c}});__MouseWheelObserver=Class.create(__EventObserver,{initialize:function(){this.eventType="wheel"},getEventFrame:function(d){var b=Event.pointerX(d);var a=Event.pointerY(d);var f=xxx;var e=yyy;var c=new __MouseWheelEventFrame(b,a,new Date().getTime());return c}});__KeypressObserver=Class.create(__EventObserver,{initialize:function(){this.eventType="keyup"},getEventFrame:function(d){var a=d.keycode;var b=d.element();var e=null;if(b.value){e=b.value}var c=new __KeypressEventFrame(a,b,e,new Date().getTime());return c}});__EventRecorder=Class.create({initialize:function(){this.mouseMoveObserver=new __MouseMoveObserver();this.mouseClickObserver=new __MouseClickObserver();this.mouseWheelObserver=new __MouseWheelObserver();this.keypressObserver=new __KeypressObserver();this.timer=null;this.STATUS_STOPPED=0;this.STATUS_PLAYING=1;this.STATUS_RECORDING=2},reset:function(){this.currentFrame=0;this.status=this.STATUS_STOPPED;this.timer=null},play:function(){if(this.status!=this.STATUS_STOPPED){this.stop()}this.status=this.STATUS_PLAYING;this.showMousePointer();var a=(__RecordingSession.getInstance()).getEvents();for(;this.currentFrame<a.length&&this.status==this.STATUS_PLAYING;this.currentFrame++){var b=a[this.currentFrame];this.timer=setTimeout(b.play.bind(b),b.time)}this.reset()},stop:function(){if(this.status==this.STATUS_RECORDING){this.mouseMoveObserver.stopObserving();this.mouseClickObserver.stopObserving();this.mouseWheelObserver.stopObserving();this.keypressObserver.stopObserving();this.currentFrame=0}this.timer=null;this.status=this.STATUS_STOPPED},record:function(){if(this.status!=this.STATUS_STOPPED){this.stop()}this.status=this.STATUS_RECORDING;this.mouseMoveObserver.startObserving();this.mouseClickObserver.startObserving();this.mouseWheelObserver.startObserving();this.keypressObserver.startObserving()},rewind:function(){this.currentFrame=0},forward:function(){this.currentFrame=this.getTotalFrames()},getCurrentFrame:function(){return this.currentFrame},getTotalFrames:function(){var a=(__RecordingSession.getInstance()).getEvents();var b=a.length;return b},showMousePointer:function(){if(!$("mousepointer")){var a=new Element("img",{src:"/forms/recorder/mousepointer.gif",id:"mousepointer",style:"width: 12px; height: 21px; position: absolute; z-index: 100000;"});document.getElementsByTagName("body")[0].appendChild(a)}$("mousepointer").style.display=""},hiddenMousePointer:function(){if($("mousepointer")){$("mousepointer").style.display="none"}}});__RecordingSession=Class.create({initialize:function(){this.events=new Array();this.starttime=new Date().getTime();this.lockRecord=null},clear:function(){this.events=new Array();this.starttime=new Date().getTime();this.lockRecord=null},saveFrame:function(a){this.lockRecord=null;a.time=a.time-this.starttime;this.events[this.events.length]=a},getEvents:function(){return this.events}});__RecordingSession.getInstance=function(){if(!__RecordingSession.hasOwnProperty("instance")){__RecordingSession.instance=new __RecordingSession()}return __RecordingSession.instance};
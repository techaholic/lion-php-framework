var __ClientEventHandler=Class.create({initialize:function(){this.code=null;this.url="index.ajax";this.debug=false;this.valueHolders=new Hash();this._latestInteractiveResponse=null;this.allowEvents=true},setCode:function(a){this.code=a},getCode:function(){return this.code},setUrl:function(a){this.url=a},getUrl:function(){return this.url},setDebug:function(a){this.debug=a},getDebug:function(){return this.debug},registerValueHolder:function(a){this.valueHolders.set(a.getCode(),a)},updateValueHolder:function(b,c){var a=this.valueHolders.get(b);if(typeof(a)!="undefined"){if(c==null){c=""}a.setValue(c)}},getClientValues:function(){var a=new Hash();this.valueHolders.each(function(c){if(c.value.isUnsynchronized()){var b=c.value.getValue();if(b==null){b=""}a.set(c.key,b)}});return a},startWaiting:function(b,c){var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(b);if(typeof(a)!="undefined"){a.startWaiting()}if(window[b+"_spinner"]){window[b+"_spinner"]["startWaiting"]();if(c==true){window[b+"_spinner"]["startProgressBar"]()}return window[b+"_spinner"]}},stopWaiting:function(b){if(window[b+"_spinner"]){window[b+"_spinner"]["stopWaiting"]()}var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(b);if(typeof(a)!="undefined"){a.stopWaiting()}},_addClientEndPointValuesToForm:function(a){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","clientEndpointValues");b.setAttribute("value",this.getClientValues().toJSON());a.appendChild(b)},_waitToSubmitForm:function(b){var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(b.id);if(typeof(a)!="undefined"&&a.isWaiting()){window.setTimeout((this._waitToSubmitForm).bind(this,b),500)}else{this._addClientEndPointValuesToForm(b);b.submit()}},_handleFormWaiting:function(e){var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(e.id);if(typeof(a)!="undefined"&&a.isWaiting()){var d=e.getInputs("submit");for(var c=0,g=d.length;c<g;c++){var b=d[c];var f=this.startWaiting(b.id);if(typeof(f)!="undefined"){a.registerUiProgressIndicator(f)}}this._waitToSubmitForm(e)}},handleSubmit:function(b){this.allowEvents=false;var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(b.id);if(typeof(a)!="undefined"&&a.isWaiting()){this._handleFormWaiting(b);return false}else{this._addClientEndPointValuesToForm(b);return true}},handleEvent:function(d){var b=Event.element(d).id;var a=d.type;var c=null;this.sendEvent(a,c,b)},sendEvent:function(a,d,b,c){if(!c){this.startWaiting(b)}this._doSendEvent(a,d,b)},_doSendEvent:function(a,d,c){if(this.allowEvents){var b=new __MessageProcessor();new __LionAjaxRequest(this.url,{asynchronous:true,evalJS:false,evalJSON:false,method:"post",parameters:{pageId:this.getCode(),clientEndpointValues:this.getClientValues().toJSON(),event:$H({componentId:c,eventName:a,extraInfo:d}).toJSON()},requestHeaders:{Accept:"text/javascript, text/html, application/xml, text/xml, application/json, */*"},onInteractive:this.handleInteractiveServerResponse.bind(this,c,b),onSuccess:this.handleServerResponse.bind(this,c,b),onFailure:this.stopWaiting.bind(this,c)})}},handleInteractiveServerResponse:function(b,a,c){if(c.responseText){(__JSONHelper.extractJSON(c.responseText)).each((function(d,e){d.process(Object.extend(new __Message(),e))}).bind(this,a))}},handleServerResponse:function(c,b,d){this.stopWaiting(c);if(d.responseText){var a=__JSONHelper.extractJSON(d.responseText);a.each((function(e,f){e.process(Object.extend(new __Message(),f))}).bind(this,b))}if(window.hasOwnProperty("showAllExamples")){(window.showAllExamples)()}}});__LionAjaxRequest=Class.create(Ajax.Request,{request:function($super,a){if(/MSIE/.test(navigator.userAgent)==false){this.transport.multipart=true}$super(a)}});__ClientEventHandler.getInstance=function(){if(!__ClientEventHandler.hasOwnProperty("instance")){__ClientEventHandler.instance=new __ClientEventHandler()}return __ClientEventHandler.instance};__ProgressHandler=Class.create({initialize:function(a){this._element=a;this._code=a.id;this._progressHandlers=new Hash();this._dependantProgressHandlers=new Hash();this._progressIndicator=null;this._uiProgressIndicators=new Hash();this._waiting=0},getCode:function(){return this._code},startWaiting:function(){this._waiting+=1;this._dependantProgressHandlers.each(function(a){(a.value).startWaiting()})},stopWaiting:function(){if(this.isWaiting()){this._waiting-=1;this._dependantProgressHandlers.each(function(a){(a.value).stopWaiting()})}},isWaiting:function(){var a=false;if(this._waiting>0){a=true}return a},registerUiProgressIndicator:function(a){this._uiProgressIndicators.set(a.getCode(),a)},registerProgressHandler:function(a){this._progressHandlers.set(a.getCode(),a);a.registerDependantProgressHandler(this)},registerDependantProgressHandler:function(a){this._dependantProgressHandlers.set(a.getCode(),a)},setProgress:function(a){if(this._progressIndicator==null){this._progressIndicator=new __ProgressIndicator(this._code)}(this._progressIndicator).setProgress(a);this.updateUIProgressIndicators();this._dependantProgressHandlers.each(function(b){(b.value).updateUIProgressIndicators()})},getProgress:function(){var b=0;var a=0;if(this._progressIndicator!=null){a+=1;b=this._progressIndicator.getProgress()}this._progressHandlers.each(function(c){if((c.value).isWaiting()||(c.value).getProgress()==100){b+=(c.value).getProgress();a+=1}});if(a>0){b=Math.round(b/a)}return b},updateUIProgressIndicators:function(){var a=this.getProgress();this._uiProgressIndicators.each(function(b){(b.value).setProgress(a)})}});__ProgressIndicator=Class.create({initialize:function(a){this._code=a;this._progress=0},getCode:function(){return this._code},setProgress:function(a){if(a<0){a=0}else{if(a>100){a=100}}this._progress=a},getProgress:function(){return this._progress}});__ProgressBroadcaster=Class.create({initialize:function(){this._progressHandlers=new Hash()},registerProgressHandler:function(a){this._progressHandlers.set(a.getCode(),a)},getProgressHandler:function(c){var a=this._progressHandlers.get(c);if(typeof(a)=="undefined"){if($(c)){var b=$(c);a=new __ProgressHandler(b);this.registerProgressHandler(a)}}return a},setWaitingDependence:function(d,c){var b=this.getProgressHandler(d);var a=this.getProgressHandler(c);if(typeof(b)!="undefined"&&typeof(a)!="undefined"){b.registerProgressHandler(a)}},updateProgress:function(c,b){var a=this.getProgressHandler(c);if(typeof(a)!="undefined"){a.setProgress(b)}}});__ProgressBroadcaster.getInstance=function(){if(!__ProgressBroadcaster.hasOwnProperty("instance")){__ProgressBroadcaster.instance=new __ProgressBroadcaster()}return __ProgressBroadcaster.instance};var AJAX_MESSAGE_STATUS_OK=1;var AJAX_MESSAGE_STATUS_ERROR=-1;var AJAX_MESSAGE_STATUS_REDIRECT=302;__Message=Class.create({initialize:function(){this.header=null;this.commands=new Array();this._resolved=false},getHeader:function(){this._resolve();return this.header},getCommands:function(){this._resolve();return this.commands},_resolve:function(){if(this._resolved==false){this.header=Object.extend(new __MessageHeader(),this.header);var a=new Array();for(var c=0,b=this.commands.length;c<b;c++){if(this.commands[c].hasOwnProperty("class")&&window[this.commands[c]["class"]]&&this.commands[c].hasOwnProperty("data")){a[a.length]=Object.extend(new window[this.commands[c]["class"]](),this.commands[c]["data"])}}this.commands=a;this._resolved=true}}});__MessageHeader=Class.create({initialize:function(){this.id=null;this.status=0;this.location=null;this.message=null;this.pageId=null},getId:function(){return this.id},getStatus:function(){return this.status},getLocation:function(){return this.location},getPageId:function(){return this.pageId}});var __MessageProcessor=Class.create({initialize:function(){this.processedMessageIds=new Hash()},process:function(b){var a=(b.getHeader()).getId();var c=this.processedMessageIds.get(a);if(typeof(c)=="undefined"){this.processedMessageIds.set(a,true);__MessageProcessor.process(b)}}});__MessageProcessor.process=function(e){var f=e.getHeader();var b=f.getStatus();if(b==AJAX_MESSAGE_STATUS_OK){var a=e.getCommands();for(var d=0,c=a.length;d<c;d++){a[d].execute()}}else{switch(b){case AJAX_MESSAGE_STATUS_REDIRECT:document.location.href=f.getLocation();break;case AJAX_MESSAGE_STATUS_ERROR:default:if(f.message!=null&&f.message!=""){alert(f.message)}break}}};var __RegisterValueHolderCommand=Class.create({initialize:function(){this.valueHolderData=new Hash()},execute:function(){var a=__ValueHolderFactory.createValueHolder(this.valueHolderData);if(a){(__ClientEventHandler.getInstance()).registerValueHolder(a)}}});var __RegisterEventListenerCommand=Class.create({initialize:function(){this.element=null;this.event=null},execute:function(){if($(this.element)){if(this.event.toUpperCase()=="LOAD"){(__ClientEventHandler.getInstance()).sendEvent(this.event,null,this.element)}else{var a=__ClientEventHandler.getInstance();$(this.element).observe(this.event,a.handleEvent.bind(a))}}}});var __UpdateValueHolderCommand=Class.create({initialize:function(){this.code=null;this.value=null},execute:function(){(__ClientEventHandler.getInstance()).updateValueHolder(this.code,this.value)}});var __ExecuteCallbackCommand=Class.create({initialize:function(){this.receiver=null;this.method=null;this.parameter=null},execute:function(){}});var __ExecuteObjectCallbackCommand=Class.create(__ExecuteCallbackCommand,{execute:function(){if(this.receiver!=null&&this.method!=null){if(window[this.receiver]&&window[this.receiver][this.method]){window[this.receiver][this.method](this.parameter)}}}});var __ExecuteElementCallbackCommand=Class.create(__ExecuteCallbackCommand,{execute:function(){if(this.receiver!=null&&this.method!=null){if($(this.receiver)&&$(this.receiver)[this.method]){$(this.receiver)[this.method](this.parameter)}}}});var __ExecuteJavascriptOnDemandCommand=Class.create({initialize:function(){this.code=null},execute:function(){eval(this.code)}});var __UpdateProgressIndicatorCommand=Class.create({initialize:function(){this.code=null;this.progress=null},execute:function(){(__ProgressBroadcaster.getInstance()).updateProgress(this.code,this.progress)}});var __ShowValidationErrorCommand=Class.create({initialize:function(a,b){this.message=a;this.receiver=b},execute:function(){if(window[this.receiver]&&window[this.receiver]["onInvalid"]){window[this.receiver]["message"]=this.message;if(this.message!=null&&this.message!=""){window[this.receiver]["validationFailed"]=true;window[this.receiver]["displayMessageWhenEmpty"]=true;window[this.receiver]["onInvalid"]()}else{window[this.receiver]["removeMessageAndFieldClass"]()}}}});var __ValueHolderFactory=Class.create();__ValueHolderFactory.createValueHolder=function(d){var e=null;if(d.hasOwnProperty("valueHolderClass")){var a=d.valueHolderClass;if(a=="__ElementProperty"){var c=d.receiver;if($(c)){var b=$(c).type;if(b=="select-one"){e=Object.extend(new __SelectElementProperty(),d)}else{if(b=="checkbox"||b=="radio"){e=Object.extend(new __CheckableElementProperty(),d)}else{e=Object.extend(new __ElementProperty(),d)}}}}else{if(window[a]){e=Object.extend(new window[a](),d)}}}return e};var __ValueHolder=Class.create({initialize:function(){this.code=null;this.receiver=null;this.property=null;this.value=null;this.syncServer=true},isUnsynchronized:function(){var a=false;if(this.allowSyncToServer()){a=true}return a},allowSyncToServer:function(){return true},getCode:function(){return this.code},getReceiver:function(){return this.receiver},getProperty:function(){return this.property},setValue:function(a){this.value=a},getValue:function(){return null}});var __ElementProperty=Class.create(__ValueHolder,{setValue:function(b){if(this.receiver!=null&&b!=this.getValue()){if(document.getElementById(this.receiver)){var a=$(this.receiver);if(this.property.toUpperCase()=="INNERHTML"){a.innerHTML=b}else{if(this.property.toUpperCase()=="VALUE"){a.value=b}else{if(a[this.property]){a[this.property]=b}else{a.writeAttribute(this.property,b)}}}}}},getValue:function(){var a=null;if(this.receiver!=null){if(document.getElementById(this.receiver)){var b=$(this.receiver);if(this.property.toUpperCase()=="INNERHTML"){a=b.innerHTML}else{if(this.property.toUpperCase()=="VALUE"){if(b.exampleValue&&b.exampleValue==b.value){a=null}else{a=b.value}}else{if(b[this.property]){a=b[this.property]}else{a=b.readAttribute(this.property)}}}}}return a},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&document.getElementById(this.receiver)){a=true}return a}});var __ElementAccessor=Class.create(__ValueHolder,{initialize:function(){this.code=null;this.receiver=null;this.setter=null;this.getter=null;this.value=null},setValue:function(b){if(this.receiver!=null&&this.setter!=null){if(this.getter==null||(this.getter!=null&&b!=this.getValue())){if(document.getElementById(this.receiver)){var a=$(this.receiver);if(typeof(a[this.setter])=="function"){a[this.setter](b)}}}}},getValue:function(){var a=null;if(this.receiver!=null&&this.getter!=null){if(document.getElementById(this.receiver)){var b=$(this.receiver);if(typeof(b[this.getter])=="function"){a=b[this.getter]()}}}return a},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&this.getter!=null){if(document.getElementById(this.receiver)){var b=$(this.receiver);if(typeof(b[this.getter])=="function"){a=true}}}return a}});var __CheckableElementProperty=Class.create(__ValueHolder,{setValue:function(a){if(this.receiver!=null&&a!=this.getValue()){if(document.getElementById(this.receiver)){if(this.property.toUpperCase()=="VALUE"){if(a==true){$(this.receiver).checked=true}else{$(this.receiver).checked=false}}}}},getValue:function(){var a=false;if(this.receiver!=null){if(document.getElementById(this.receiver)){if(this.property.toUpperCase()=="VALUE"){a=$(this.receiver).checked}}}return a},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&document.getElementById(this.receiver)&&this.property.toUpperCase()=="VALUE"){a=true}return a}});var __SelectElementProperty=Class.create(__ValueHolder,{setValue:function(f){if(this.receiver!=null){if(document.getElementById(this.receiver)){if(this.property.toUpperCase()=="SELECTEDINDEX"){$(this.receiver).selectedIndex=f}else{if(this.property.toUpperCase()=="ITEMS"){var e=document.getElementById(this.receiver);var a=e.options.selectedIndex;e.options.length=0;if(!this.isEmpty(f)){for(var b=0,g=f.size();b<g;b++){var d=f[b];var c=false;if(e.options.length==a){c=true}var h=d[1];if(h==null){h=""}e.options[e.options.length]=new Option(d[0],h,false,c)}}}}}}},getValue:function(){var b=null;if(this.receiver!=null){if(document.getElementById(this.receiver)){if(this.property.toUpperCase()=="SELECTEDINDEX"){b=$(this.receiver).selectedIndex}else{if(this.property.toUpperCase()=="ITEMS"){b=new Array();for(var a=0,d=$(this.receiver).options.length;a<d;a++){var c=$(this.receiver).options[a].value;if(c==null){c=""}b[b.length]=[$(this.receiver).options[a].text,c]}}}}}return b},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&document.getElementById(this.receiver)){a=true}return a},typeOf:function(b){var a=typeof b;if(a==="object"){if(b){if(typeof b.length==="number"&&!(b.propertyIsEnumerable("length"))&&typeof b.splice==="function"){a="array"}}else{a="null"}}return a},isEmpty:function(c){var b,a;if(this.typeOf(c)==="array"){for(b in c){a=c[b];if(a!==undefined&&this.typeOf(a)!=="function"){return false}}}return true}});var __ObjectProperty=Class.create(__ValueHolder,{getPropertyAccessor:function(a){var b=null;if(this.receiver!=null&&this.property!=null){if(window[this.receiver]){if(window[this.receiver][a+this.property.capitalize()]){b=a+this.property.capitalize()}else{if(window[this.receiver][a+this.property.charAt(0).toUpperCase()+this.property.substr(1)]){b=a+this.property.charAt(0).toUpperCase()+this.property.substr(1)}}}}return b},setValue:function(b){if(this.receiver!=null&&this.property!=null&&b!=this.getValue()){if(window[this.receiver]){var a=this.getPropertyAccessor("set");if(a!=null){window[this.receiver][a](b)}else{if(window[this.receiver][this.property]){window[this.receiver][this.property]=b}}}}},getValue:function(){var b=null;if(this.receiver!=null&&this.property!=null){if(window[this.receiver]){var a=this.getPropertyAccessor("get");if(a!=null){b=window[this.receiver][a]()}else{if(window[this.receiver][this.property]){b=window[this.receiver][this.property]}}}}return b},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&this.property!=null&&window[this.receiver]){a=true}return a}});var __Object=Class.create(__ValueHolder,{setValue:function(a){if(this.receiver!=null&&a!=this.getValue()){if(window[this.receiver]){window[this.receiver]=a}}},getValue:function(){var a=null;if(this.receiver!=null){a=window[this.receiver]}return a},allowSyncToServer:function(){var a=false;if(this.receiver!=null&&window[this.receiver]){a=true}return a}});var DomLoaded={onload:[],loadComplete:false,listeningEvent:false,isLoaded:function(){return DomLoaded.loadComplete},loaded:function(){DomLoaded.loadComplete=true;if(arguments.callee.done){return}arguments.callee.done=true;for(var a=0;a<DomLoaded.onload.length;a++){DomLoaded.onload[a]()}DomLoaded.onload=[]},load:function(fireThis){if(DomLoaded.isLoaded()){return fireThis()}DomLoaded.onload.push(fireThis);if(DomLoaded.listeningEvent==true){return}if(document.addEventListener){document.addEventListener("DOMContentLoaded",DomLoaded.loaded,null)}if(/KHTML|WebKit/i.test(navigator.userAgent)){var _timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(_timer);delete _timer;DomLoaded.loaded()}},10);
/*@cc_on @*/
/*@if (@_win32)
        var proto = "src='javascript:void(0)'";
        if (location.protocol == "https:") proto = "src=//0";
        document.write("<scr"+"ipt id=__ie_onload defer " + proto + "><\/scr"+"ipt>");
        var script = document.getElementById("__ie_onload");
        script.onreadystatechange = function() {
        if (this.readyState == "complete") {
        DomLoaded.loaded();
        }
        };
        /*@end @*/
}window.onload=DomLoaded.loaded;DomLoaded.listeningEvent=true}};var __Spinner=Class.create({timeUntilShow:250,opacity:0.8,initialize:function(a){this.elementName=a;this.className=null;this.code="spinner_"+a;this.waitingMessage=null},setWaitingMessage:function(a){this.waitingMessage=a},getWaitingMessage:function(){return this.waitingMessage},getCode:function(){return this.code},startProgressBar:function(){var c=$(this.elementName);if(!c){return}if(!this._loadingProgressBar){var b=document.createElement("div");(c.offsetParent||document.body).appendChild(this._loadingProgressBar=b);var h=document.createElement("div");(c.offsetParent||document.body).appendChild(this._loadingProgressBarInsideArea=h);var d=document.createElement("div");(c.offsetParent||document.body).appendChild(this._loadingProgressBarCompletedArea=d);var e=c.getDimensions();var a=c.positionedOffset();var b=this._loadingProgressBar;var f=a.top+e.height+2;var g=3;b.style.position="absolute";b.style.left=a.left+"px";b.style.top=f+"px";b.style.width=e.width+"px";b.style.height=g+"px";b.style.display="inline";b.style.backgroundColor="black";h.style.position="absolute";h.style.left=(a.left+1)+"px";h.style.top=(f+1)+"px";h.style.width=(e.width-2)+"px";h.style.height=(g-2)+"px";h.style.display="inline";h.style.backgroundColor="white";d.style.position="absolute";d.style.left=(a.left+1)+"px";d.style.top=(f+1)+"px";d.style.width=1+"px";d.style.height=(g-2)+"px";d.hide();d.style.backgroundColor="blue"}},setProgress:function(b){var c=$(this.elementName);if(!c){return}if(!this._loadingProgressBar){this.startProgressBar()}if(b<=0){b=0}if(b>=100){b=100}var e=this._loadingProgressBarCompletedArea;e.style.display="inline";var f=c.getDimensions();var a=f.width-2;var d=b*a/100;e.style.width=Math.round(d)},startWaiting:function(f){var b=$(this.elementName);if(!b){return}if(f==undefined){f=this.timeUntilShow}this._spinner=true;if(!this._loading){if(this.waitingMessage!=null){var a=document.createElement("div");a.innerHTML=this.waitingMessage;(b.offsetParent||document.body).appendChild(this._waitingMessage=a)}var c=document.createElement("div");(b.offsetParent||document.body).appendChild(this._loading=c);c.style.position="absolute";try{c.style.opacity=this.opacity}catch(d){}try{c.style.MozOpacity=this.opacity}catch(d){}try{c.style.filter="alpha(opacity="+Math.round(this.opacity*100)+")"}catch(d){}try{c.style.KhtmlOpacity=this.opacity}catch(d){}}if(this.className==undefined){this._loading.style.backgroundImage='url("resources/images/misc/spinner.gif")';this._loading.style.backgroundRepeat="no-repeat";this._loading.style.backgroundPosition="center center";this._loading.style.backgroundColor="white"}else{this._loading.className=this.className}window.setTimeout((function(g){var i=g.getDimensions();var e=g.positionedOffset();if(this._loading){var h=this._loading;h.style.width=i.width+"px";h.style.height=i.height+"px";h.style.left=e.left+"px";h.style.top=e.top+"px";h.style.display="inline"}this._relocateSpinner(g)}).bind(this,b),f)},_relocateSpinner:function(c){var f=c.getDimensions();var a=c.positionedOffset();if(this._spinner){var e=this._loading;if(e.style.left!=a.left+"px"||e.style.top!=a.top+"px"){e.style.left=a.left+"px";e.style.top=a.top+"px";if(this._loadingProgressBar){var b=this._loadingProgressBar;var h=this._loadingProgressBarInsideArea;var d=this._loadingProgressBarCompletedArea;var g=a.top+f.height+2;b.style.left=a.left+"px";b.style.top=g+"px";h.style.left=(a.left+1)+"px";h.style.top=(g+1)+"px";d.style.left=(a.left+1)+"px";d.style.top=(g+1)+"px"}}window.setTimeout((this._relocateSpinner).bind(this,c),100)}},stopWaiting:function(){var a=$(this.elementName);if(!a){return}if(this._spinner){this._spinner=false;this._loading.parentNode.removeChild(this._loading);this._loading=null}if(this._waitingMessage){this._waitingMessage.parentNode.removeChild(this._waitingMessage);this._waitingMessage=null}if(this._loadingProgressBar){this._loadingProgressBar.parentNode.removeChild(this._loadingProgressBar);this._loadingProgressBarInsideArea.parentNode.removeChild(this._loadingProgressBarInsideArea);this._loadingProgressBarCompletedArea.parentNode.removeChild(this._loadingProgressBarCompletedArea);this._loadingProgressBar=null;this._loadingProgressBarInsideArea=null;this._loadingProgressBarCompletedArea=null}}});var __JSONHelper={extractJSON:function(f){var b=false;var h=cBrackets=parens=0;var a=new Array();var g=0;for(var c=0;c<f.length;c++){if(cBrackets<0||h<0||parens<0){return null}if(b==true){switch(f.slice(c,c+1)){case"\\":c++;break;case'"':b=false;break}}else{switch(f.slice(c,c+1)){case'"':b=true;break;case"{":cBrackets++;break;case"}":cBrackets--;break;case"[":h++;break;case"]":h--;break;case"(":parens++;break;case")":parens++;break}}if(cBrackets==0&&h==0&&parens==0){var e=f.slice(g,c+1);if(e.isJSON()){var d=e.evalJSON(true);a.push(d)}g=c+1}}return a}};var __FileUploader=Class.create({initialize:function(a){this.input=a;this.inputDiv=new Element("div",{id:"input_div_"+(this.input).id,style:"display: inline;"});(this.input).parentNode.appendChild(this.inputDiv);(this.inputDiv).appendChild(this.input);this._addEventHandlers(this.input);this.cancelled=false;this.uploadMode=1;this.executeBeforeUploadEvent=false;this.cancelLink=new Element("a",{href:"javascript: void(0);",id:"cancel_"+a.id}).update("Cancel");this.cancelLink.observe("click",function(d){this.cancel()}.bind(this));this.fileCheckbox=new Element("input",{type:"checkbox",id:"checkbox_"+a.id,checked:true});this.fileCheckbox.observe("click",function(d){this.reset()}.bind(this));this.filenameSpan=new Element("span",{id:"checkboxcaption_"+this.input.id});this.cancellingSpan=new Element("span",{id:"checkboxcaption_"+this.input.id}).update("Cancelling...");var b=new Element("iframe",{src:"",id:"iframe_"+(this.input).id,name:"iframe_"+(this.input).id,style:"display: none; width: 0px; height: 0; border: 0px;"});var c=new Element("div",{id:"div_"+(this.input).id,style:"display: none;"});this.asyncForm=new Element("form",{id:"form_"+(this.input).id,name:"form_"+(this.input).id,enctype:"multipart/form-data",target:"iframe_"+(this.input).id,method:"POST",action:"upload.async"});c.appendChild(this.asyncForm);this.apc_upload_progress=new Element("input",{type:"hidden",name:"APC_UPLOAD_PROGRESS",value:this.input.id});this.asyncForm.appendChild(this.apc_upload_progress);document.body.appendChild(c);document.body.appendChild(b)},setExecuteBeforeUploadEvent:function(a){this.executeBeforeUploadEvent=a},reset:function(){if(!this.fileCheckbox.checked){(__ClientEventHandler.getInstance()).sendEvent("cancelUpload",{},(this.input).id,true);if($(this.fileCheckbox.id)){$(this.fileCheckbox.id).remove()}if($(this.filenameSpan.id)){$(this.filenameSpan.id).remove()}(this.inputDiv).style.display="inline"}if($("async_"+this.input.id)){this.asyncForm.reset();var b=this.input.id;this.apc_upload_progress.value=b;var a=$("async_"+this.input.id);this.input.parentNode.insertBefore(a,this.input);this.input.remove();this.input=a;this.input.id=b}},cancel:function(){this.cancelled=true;if($("iframe_"+this.input.id)){var a=$("iframe_"+this.input.id);a.remove();document.body.appendChild(a)}(this.cancelLink).remove();((this.inputDiv).parentNode).appendChild(this.cancellingSpan);this._handleCancel()},_handleCancel:function(){var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(this.input.id);if(a.isWaiting()){window.setTimeout((this._handleCancel).bind(this),500)}else{(this.cancellingSpan).remove();this.reset();(__ClientEventHandler.getInstance()).sendEvent("cancelUpload",{},(this.input).id,true)}},upload:function(){this.cancelled=false;filename=(this.input).value;if(filename!=null&&filename!=""){var e=filename;var a=e.match(/[^\/\\]+$/);var b=(this.input).cloneNode(true);if($("async_"+this.input.id)){$("async_"+this.input.id).remove()}this.input.id="async_"+this.input.id;this.input.parentNode.insertBefore(b,this.input);this.asyncForm.appendChild(this.input);this.input=b;var c=this.asyncForm.getAttributeNode("enctype");c.value="multipart/form-data";var d=this.asyncForm.getAttributeNode("method");d.value="POST";this.asyncForm.submit();(this.input).value=null;(this.inputDiv).appendChild(this.cancelLink);(__ClientEventHandler.getInstance()).sendEvent("uploading",{},this.input.id);this._handleUploadingProcess(a)}},renderAsUploaded:function(a){(this.fileCheckbox).checked=true;(this.fileCheckbox).defaultChecked=true;(this.inputDiv).parentNode.appendChild(this.fileCheckbox);this.filenameSpan.update(a);(this.fileCheckbox).parentNode.appendChild(this.filenameSpan);(this.inputDiv).style.display="none"},_handleUploadingProcess:function(b){var a=(__ProgressBroadcaster.getInstance()).getProgressHandler(this.input.id);if(a.isWaiting()){window.setTimeout((this._handleUploadingProcess).bind(this,b),500)}else{if(this.cancelled==false){if($(this.cancelLink.id)){$(this.cancelLink.id).remove()}this.renderAsUploaded(b);(__ClientEventHandler.getInstance()).sendEvent("uploaded",{},(this.input).id,true)}}},_addEventHandlers:function(a){a.observe("change",function(b){var b=this.fire("lion:validate");if(typeof(b.validationResult)=="undefined"||(typeof(b.validationResult)!="undefined"&&b.validationResult)){this.fileUploader.upload()}}.bind(a));a.fileUploader=this}});var __ResponseCallbackHandler=Class.create({initialize:function(a){this.callback=a},execute:function(parameter){if(this.callback){callback_function=eval(this.callback);if(typeof(callback_function)=="function"){callback_function(parameter)}}}});